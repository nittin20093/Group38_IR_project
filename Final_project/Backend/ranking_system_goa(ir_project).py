# -*- coding: utf-8 -*-
"""Ranking system_Goa(IR Project)

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1l90rt4CAp8VKMMx_CmtRavAxHQS92EjF
"""

import pandas as pd
import nltk
from nltk.sentiment.vader import SentimentIntensityAnalyzer
import numpy as np
from google.colab import drive
drive.mount('/content/drive')
import ast

nltk.download('vader_lexicon')
skywalker = SentimentIntensityAnalyzer()

df=pd.read_csv("/content/drive/MyDrive/IR_Project/goa_hotels_details_final.csv")
x=df["reviews"].to_dict()
score=[]
for i in x:
  res = ast.literal_eval(x[i])
  jedi=pd.DataFrame.from_dict(res, orient='columns')
  jedi["Review_Heading"]=jedi["Review_Heading"].str.replace('‚Äù','')
  jedi["Review"] = jedi[['Review_Heading', 'Review_Body']].agg(' '.join, axis=1)
  jedi['sentiment'] = jedi['Review'].apply(lambda x: skywalker.polarity_scores(x)['compound'])
  jedi = jedi.astype({'Review_Rating':'float'})
  result = jedi['Review_Rating'].multiply(jedi['sentiment'], axis="index")
  f=result.mean()
  score.append(f)
df['Score'] = score

df=df.drop(['Unnamed: 0.1'], axis=1)
df=df.drop(['Unnamed: 0'], axis=1)
df=df.drop(['overall_rating'], axis=1)
column_to_move = df.pop("Score")
df.insert(4, "Score", column_to_move)

Sith =df.sort_values('Score', ascending=False) #ranking of hotels according to score
Sith.head()

score=[]
for ind in df.index:
  x=df['Score'][ind]
  if '403001' in df['Location'][ind]:
    x=x*2
  if '403516' in df['Location'][ind]:
    x=x*1.9
  if '403510' in df['Location'][ind]:
    x=x*1.8
  if '403708' in df['Location'][ind]:
    x=x*1.7
  if '403507' in df['Location'][ind]:
    x=x*1.6
  if '403601' in df['Location'][ind]:
    x=x*1.5
  if '403521' in df['Location'][ind]:
    x=x*1.4
  if '403723' in df['Location'][ind]:
    x=x*1.3
  if '403508' in df['Location'][ind]:
    x=x*1.2
  if '403519' in df['Location'][ind]:
    x=x*1.1
  score.append(x)
df['TouristScore'] = score  
column_to_move = df.pop("TouristScore")
df.insert(4, "TouristScore", column_to_move)

Sith =df.sort_values('TouristScore', ascending=False) #ranking of hotels according to score
Sith.head()

Sith.shape

from google.colab import files
Sith.to_csv('TouristRankedHotelsGoa.csv', sep='\t', index=False,header=True)
files.download('TouristRankedHotelsGoa.csv')